# Мечтают ли пингвины об электросвопах?

Давно прошли те времена, когда внутри операционной системы оператива рассматривалась отдельно от диска, а диск отдельно от RAM. В современных ОС это единое неразрывное понятие, называемое виртуальной памятью. В основе виртуальной памяти лежит механизм отображения файлов в память (Memory-mapped file). Каждый раз, когда запускается процесс, читается или пишется файл, запускается этот механизм. И если существующие файлы отображаются в область памяти под названием кеш, то остальная используемая память называется анонимной и отображается в своп. То есть своп это часть виртуальной памяти, и система заточена на работу со свопом. Своп, в отличии от кеша, можно отключить. Но в этом случае ядро будет работать не эффективно.

Очень подробная и понятная статья о том, что такое своп, на Хабре: https://habr.com/ru/post/540104/ часть 2 https://habr.com/ru/post/541214/
как это часто бывает, на Хабре комменты не менее полезны, чем статья.

Вот статья на английском, почему надо включать своп: https://haydenjames.io/linux-performance-almost-always-add-swap-space/

Но тогда почему сам великий Google заставляет отключать своп при запуске Kubernetes? Это вопрос открытый, и спецы склоняются к тому, что по сути программистам кубика неохота было заморачиваться с подсчётом статистики в нодах, а вовсе не потому что со свопом система работает хуже.

Обсуждение, зачем выключать своп в кубике:
https://serverfault.com/questions/881517/why-disable-swap-on-kubernetes

На гитхабе в 2017 году завели issue – сделайте нам фичу чтобы кубик не отказывался работать со свопом:
https://github.com/kubernetes/kubernetes/issues/53533

Этот issue до сих пор не закрыт. Сейчас запустить кубик со свопом можно используя ключ `--fail-swap-on=false`

One-liner, как создать своп-файл и включить его, не перезагружая систему (под рутом) (размер 4Gb):

```
dd if=/dev/zero of=/swapfile bs=1M count=4096 ; chmod 0700 /swapfile ; mkswap /swapfile ; swapon /swapfile ; echo '/swapfile       none    swap    sw      0       0' >>/etc/fstab ; cat /etc/fstab ; free -h ; cat /proc/sys/vm/swappiness ; echo 'vm.swappiness=60' >/etc/sysctl.d/swappiness.conf ; echo 60 > /proc/sys/vm/swappiness ; cat /proc/sys/vm/swappiness ; df -h
```